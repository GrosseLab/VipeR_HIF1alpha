#!perl
  #use strict;
  #use warnings;
  use SOAP::Lite;
  use HTTP::Cookies;


  ### conda install -c bioconda perl-soap-lite 
  ### conda install -c bioconda perl-lwp-protocol-https 



  my ($inputIdsFILE, $idType,$chartReportFILE) = @ARGV;

  ## DAVID 6.7
  print  "\nDAVID 6.7\n"; 
  my $soap = SOAP::Lite                             
     -> uri('http://service.session.sample')                
     -> proxy('http://david-d.ncifcrf.gov/webservice/services/DAVIDWebService',
                cookie_jar => HTTP::Cookies->new(ignore_discard=>1));

  # # ### DAVID 6.8 
  # # print  "\nDAVID 6.8\n"; 
  # my $soap = SOAP::Lite                             
  #    -> uri('http://service.session.sample')                
  #    -> proxy('https://david.ncifcrf.gov/webservice/services/DAVIDWebService',
  #               cookie_jar => HTTP::Cookies->new(ignore_discard=>1));
  # my $soap = SOAP::Lite                             
  #    -> uri('http://service.session.sample')                
  #    -> proxy('http://david.abcc.ncifcrf.gov/webservice/services/DAVIDWebService',
  #               cookie_jar => HTTP::Cookies->new(ignore_discard=>1));

 #user authentication by email address
 #For new user registration, go to http://david.abcc.ncifcrf.gov/webservice/register.htm
 my $check = $soap->authenticate('claus.weinholdt@informatik.uni-halle.de')->result;
  	print "\nUser authentication: $check\n";

 if (lc($check) eq "true") { 

 #list conversion types
 my $conversionTypes = $soap ->getConversionTypes()->result;
	 print  "\nConversion Types: \n$conversionTypes\n"; 
	 
 #list all annotation category names
 my $allCategoryNames= $soap ->getAllAnnotationCategoryNames()->result;	 	  	
 print  "\nAll available annotation category names: \n$allCategoryNames\n"; 
 
 #addList 
 # my $inputIds = '31741_at,31734_at,32696_at,37559_at,41400_at,35985_at,39304_g_at,41438_at,35067_at,32919_at,35429_at,36674_at,967_g_at,36669_at,39242_at,39573_at,39407_at,33346_r_at,40319_at,2043_s_at,1788_s_at,36651_at,41788_i_at,35595_at,36285_at,39586_at,35160_at,39424_at,36865_at,2004_at,36728_at,37218_at,40347_at,36226_r_at,33012_at,37906_at,32872_at,989_at,32718_at,36957_at,32645_at,37628_at,33825_at,35687_at,32779_s_at,34493_at,31564_at,887_at,34712_at,32897_at,34294_at,41365_at,41446_f_at,34375_at,875_g_at,41099_at,919_at,38970_s_at,39159_at,34184_at,1018_at,38032_at,35956_s_at,35536_at,34562_at,1867_at,35957_at,39519_at,41657_at,38491_at,652_g_at,35776_at,34989_at,33455_at,39950_at,37723_at,31977_at,38629_at,34581_s_at,36210_g_at,35120_at,41532_at,37889_at,1332_f_at,40540_at,41105_s_at,1919_at,37542_at,39698_at,36711_at,36809_at,1167_s_at,31648_at,32364_at,40792_s_at,38685_at,41358_at,32931_at,35294_at,39870_at,38654_at,257_at,39071_at,35606_at,41726_at,33094_s_at,32405_at,1432_s_at,33698_at,408_at,39748_at,1953_at,36100_at,36101_s_at,1372_at,35314_at,40790_at,2030_at,179_at,1852_at,259_s_at,38024_at,35376_f_at,41779_at,39232_at,41159_at,40365_at,31626_i_at,40385_at,35613_at,37506_at,38207_at,887_at,600_at,1461_at,38691_s_at,1267_at,1177_at,1125_s_at,2036_s_at,31615_i_at,37283_at,40954_at,31758_at,36960_at,33143_s_at,37048_at,38538_at,1005_at,34963_at,39408_at,32464_at,706_at,1276_g_at,164_at,41445_at,40735_at,1891_at,1258_s_at,40856_at,1911_s_at,31562_at,32359_at,274_at,1804_at,41387_r_at,848_at,41499_at,39448_r_at,34537_at,36459_at,35500_at,37139_at,612_s_at,32133_at,39757_at,37629_at,38463_s_at,568_at,749_at,1939_at,38018_g_at,1857_at,32699_s_at,40661_at,1994_at,38373_g_at,33893_r_at,1388_g_at,35345_at,1385_at,36615_at,1263_at,37385_at,1774_at,37233_at,39753_at,32626_at,35915_at,35714_at,31669_s_at,36519_at,40473_at,1750_at,33751_at,37831_at,35472_at,41825_at,34666_at,35471_g_at,31888_s_at,37722_s_at,35414_s_at,39750_at,35726_at,37662_at,33802_at,352_at,31737_at,37938_at,36161_at,31558_at,34475_at,37223_at,38953_at,37857_at,189_s_at,41169_at,33092_at,38660_at,40895_g_at,37146_at,1936_s_at,38860_at,40210_at,41180_i_at,31586_f_at,33366_at,31521_f_at,762_f_at,1124_at,36009_at,41111_at,36749_at,37310_at,31522_f_at,35768_at,39421_at,39967_at,35992_at,38356_at,39331_at,34145_at,35378_at,199_s_at,35966_at,1866_g_at,37377_i_at,37378_r_at,833_at,31586_f_at,38062_at,34981_at,1569_r_at,1548_s_at,41446_f_at,36999_at,34226_at,33385_g_at,36173_r_at,1007_s_at,35149_at,38671_at,1973_s_at,37724_at,37317_at,33829_at,36532_at,39372_at,41717_at,38221_at,37418_at,33120_at,136_at,33492_at,1602_at,41505_r_at,41736_g_at,37862_at,31859_at,40913_at,35956_s_at,32193_at,1148_s_at,1244_at,38684_at,37440_at,32186_at,1242_at,39503_s_at,224_at,38374_at,36018_at,36603_at,33288_i_at,33662_at,33555_at,33539_at,430_at,471_f_at,1369_s_at,35372_r_at,38089_at,40310_at,41106_at,41216_r_at,32815_at,37463_r_at,33470_at,40522_at,1463_at,1743_s_at,1895_at,32583_at,35440_g_at,1091_at,1649_at,287_at,32119_at,131_at,38642_at,33922_at,35886_at,38326_at,38823_s_at,41088_at,41371_at,39841_at,32486_at,41234_at,41598_at,40478_at,37606_at,37170_at,34857_at,32062_at,37762_at,36052_at,40442_f_at,41550_at,36621_at,36929_at,38645_at,34438_at,39587_at,36562_at,37155_at,36055_at,36754_at,33545_at,1520_s_at,39402_at,32265_at,32679_at,1829_at,40669_at,31694_at,41382_at,41446_f_at,38391_at,34560_at,40098_at,32522_f_at,988_at,789_at,1270_at,1139_at,33665_s_at,1237_at,412_s_at,34688_at,31353_f_at,41856_at,32928_at,37584_at,32379_f_at,936_s_at,2082_s_at,36479_at,39175_at,32007_at,36103_at,37270_at,40840_at,37206_at,37365_at,37820_at,35848_at,37111_g_at,39522_at,36760_at,35018_at,31745_at,37424_at,36507_at,719_g_at,34165_at,41850_s_at';
 # my $idType = 'AFFYMETRIX_3PRIME_IVT_ID';
 # my $inputIds = 'ILMN_1725814,ILMN_1658483,ILMN_1699651,ILMN_1775501,ILMN_2407799,ILMN_1716407,ILMN_1693014,ILMN_1661599,ILMN_1796417,ILMN_1803563,ILMN_1789793,ILMN_2401878,ILMN_1685703,ILMN_1711838,ILMN_1774685,ILMN_1680618,ILMN_1661861,ILMN_1682636,ILMN_2368530,ILMN_1698218,ILMN_2059357,ILMN_1683263,ILMN_1766551,ILMN_1795963,ILMN_1787815,ILMN_1666733,ILMN_3243616,ILMN_1718968,ILMN_2318638,ILMN_2188862,ILMN_2365465,ILMN_2407879,ILMN_2396444,ILMN_1681777,ILMN_1801122,ILMN_1681221,ILMN_1787897,ILMN_1801216,ILMN_1806845,ILMN_1677511,ILMN_2374164,ILMN_2137789,ILMN_2404112,ILMN_1722718,ILMN_1773154,ILMN_1670807,ILMN_1773567,ILMN_1660364,ILMN_2318643,ILMN_1714296,ILMN_1685580,ILMN_2054297,ILMN_1662618,ILMN_3202024,ILMN_1781285,ILMN_2401873,ILMN_1711573,ILMN_1745021,ILMN_1655904,ILMN_1702933,ILMN_1710544,ILMN_1773696,ILMN_1652280,ILMN_1696434,ILMN_1676984,ILMN_1727458,ILMN_1739241,ILMN_1759175,ILMN_2184373,ILMN_1808226,ILMN_1844408,ILMN_1653292,ILMN_1715991,ILMN_2094952,ILMN_1702691,ILMN_1718766,ILMN_1703650,ILMN_1740429,ILMN_3250483,ILMN_1720829,ILMN_1772612,ILMN_1740900,ILMN_2361862,ILMN_1731518,ILMN_1777060,ILMN_2374865,ILMN_1666742,ILMN_3240222,ILMN_1738725,ILMN_2366445,ILMN_2398107,ILMN_1657234,ILMN_2119123,ILMN_1799062,ILMN_1788384,ILMN_1655405,ILMN_3308265,ILMN_1751598,ILMN_2319588,ILMN_1721651,ILMN_2358457,ILMN_3223813,ILMN_2124802,ILMN_1729095,ILMN_2352090,ILMN_1784602,ILMN_2305116,ILMN_3196687,ILMN_2406586,ILMN_1775743,ILMN_1797596,ILMN_2134130,ILMN_1726456,ILMN_2355776,ILMN_1686697,ILMN_1724915,ILMN_1906187,ILMN_1797776,ILMN_1690807,ILMN_3235683,ILMN_2390859,ILMN_1763842,ILMN_1762407,ILMN_2219683,ILMN_2291891,ILMN_1694075,ILMN_1764361,ILMN_1688103,ILMN_1804822,ILMN_1838885,ILMN_1833858,ILMN_1730639,ILMN_1843198,ILMN_1672295,ILMN_2110908,ILMN_2179083,ILMN_1753111,ILMN_3236858,ILMN_1669523,ILMN_1653871,ILMN_1774077,ILMN_1659936,ILMN_1674811,ILMN_1720373,ILMN_2150851,ILMN_2096784,ILMN_2284744,ILMN_2399304,ILMN_1675507,ILMN_1806023,ILMN_1794038,ILMN_2054607,ILMN_1678968,ILMN_1752810,ILMN_1791280,ILMN_1682717,ILMN_1803811,ILMN_2374159,ILMN_2239754,ILMN_1737406,ILMN_1666503,ILMN_1712112,ILMN_1677402,ILMN_1814305,ILMN_1755741,ILMN_1714349,ILMN_1738552,ILMN_1760922,ILMN_2412281,ILMN_1705814,ILMN_1679929,ILMN_1784294,ILMN_3307841,ILMN_1775542,ILMN_2266948,ILMN_1710514,ILMN_1753342,ILMN_1730504,ILMN_1700413,ILMN_2392189,ILMN_1673586,ILMN_1698621,ILMN_1703955,ILMN_1669928,ILMN_1685714,ILMN_1723021,ILMN_1742534,ILMN_1745964,ILMN_1757872,ILMN_1904578,ILMN_2383419,ILMN_2327947,ILMN_1815079,ILMN_1695000,ILMN_1707748,ILMN_2199389,ILMN_2380605,ILMN_1735014,ILMN_2412384,ILMN_1811258,ILMN_2086077,ILMN_1799208,ILMN_1801610,ILMN_1781173,ILMN_3250104,ILMN_1737157,ILMN_1808325,ILMN_2150856,ILMN_1675992,ILMN_3241099,ILMN_1679826,ILMN_1777233,ILMN_1657248,ILMN_1732926,ILMN_2237428,ILMN_1792305,ILMN_1908989,ILMN_1766054,ILMN_2400322,ILMN_1689059,ILMN_2053281,ILMN_2246134,ILMN_2342066,ILMN_1756806,ILMN_2317658,ILMN_3250446,ILMN_1701869,ILMN_1694810,ILMN_1797822,ILMN_1727134,ILMN_1762608,ILMN_1695961,ILMN_1795835,ILMN_1772459,ILMN_3240605,ILMN_1654542,ILMN_1708016,ILMN_1736008,ILMN_2305112,ILMN_1739570,ILMN_1827736,ILMN_1691846,ILMN_1741171,ILMN_2361478,ILMN_2052208,ILMN_1844692,ILMN_1671442,ILMN_3251445,ILMN_1683146,ILMN_3243324,ILMN_1806165,ILMN_2404917,ILMN_3299447,ILMN_1762080,ILMN_1805534,ILMN_1709882,ILMN_1769615,ILMN_1717639,ILMN_1717056,ILMN_1769449,ILMN_1720053,ILMN_1755290,ILMN_2336094,ILMN_1785191,ILMN_1692864,ILMN_1770035,ILMN_1687315,ILMN_1809417,ILMN_1727001,ILMN_1737314,ILMN_1708516,ILMN_1652487,ILMN_1692177,ILMN_1774272,ILMN_1730670,ILMN_1685109,ILMN_1764396,ILMN_1664006,ILMN_1684316,ILMN_1788002,ILMN_1681644,ILMN_2091375,ILMN_2094360,ILMN_1727813,ILMN_3275771,ILMN_1687583,ILMN_1773413,ILMN_2345319,ILMN_2371590,ILMN_1714805,ILMN_3305735,ILMN_1691112,ILMN_2184612,ILMN_2190598,ILMN_1705579,ILMN_3204346,ILMN_3226012,ILMN_1806667,ILMN_1687743,ILMN_2415786,ILMN_1728785,ILMN_2395240,ILMN_2067852,ILMN_1786050,ILMN_1663080,ILMN_2271627,ILMN_1801984,ILMN_2192281,ILMN_1804938,ILMN_1699574,ILMN_3249501,ILMN_1769779,ILMN_1843932,ILMN_1734410,ILMN_3235647,ILMN_1803464,ILMN_2405684,ILMN_2075714,ILMN_2324421,ILMN_1726199,ILMN_3232219,ILMN_2149226,ILMN_1771800,ILMN_2370692,ILMN_1698323,ILMN_3243961,ILMN_1776788,ILMN_1810864,ILMN_1808789,ILMN_2392286,ILMN_2294684,ILMN_1666494,ILMN_2406501,ILMN_1715771,ILMN_1731699,ILMN_2209163,ILMN_1674782,ILMN_3235964,ILMN_1720988,ILMN_1716790,ILMN_1763104,ILMN_1805192,ILMN_1651496,ILMN_2367239,ILMN_1707137,ILMN_1671404,ILMN_1741628,ILMN_1694589,ILMN_1749521,ILMN_1761314,ILMN_1689004,ILMN_1735959,ILMN_1746375,ILMN_1663640,ILMN_1804737,ILMN_1680738,ILMN_3245062,ILMN_1767662,ILMN_1694475,ILMN_2310296,ILMN_1708858,ILMN_2275248,ILMN_1778168,ILMN_2215881,ILMN_1735877,ILMN_2075820,ILMN_1769135,ILMN_1789364,ILMN_2391231,ILMN_3239885,ILMN_1679041,ILMN_1680139,ILMN_2214678,ILMN_1777895,ILMN_1753567,ILMN_3236428,ILMN_1741224,ILMN_1775573,ILMN_1724753,ILMN_2322375,ILMN_1784328,ILMN_1702211,ILMN_1815141,ILMN_2074044,ILMN_1752631,ILMN_1666615,ILMN_2377210,ILMN_3245310,ILMN_1745112,ILMN_2357134,ILMN_1758232,ILMN_1793651,ILMN_2220184,ILMN_3280735,ILMN_1736340,ILMN_1727553,ILMN_3221790,ILMN_2349459,ILMN_1715508,ILMN_1758164,ILMN_2096083,ILMN_1674633,ILMN_1736939,ILMN_1696946,ILMN_1660793,ILMN_1764329,ILMN_1760649,ILMN_1758339,ILMN_1668634,ILMN_2188374,ILMN_1679867,ILMN_1776181,ILMN_1851547,ILMN_2386354,ILMN_1769082,ILMN_1698139,ILMN_1680378,ILMN_3305273,ILMN_2202423,ILMN_3298716,ILMN_3249645,ILMN_1701441,ILMN_1683538,ILMN_1680154,ILMN_1747183,ILMN_2371825,ILMN_1759232,ILMN_2094776,ILMN_3226082,ILMN_2293374,ILMN_1779847,ILMN_2149766,ILMN_1734559,ILMN_1703412,ILMN_2395389,ILMN_2406873,ILMN_2143250,ILMN_1757867,ILMN_1671005,ILMN_1653824,ILMN_2366334,ILMN_3207233,ILMN_1681283,ILMN_3238854,ILMN_1814526,ILMN_1731113,ILMN_1773959,ILMN_2336609,ILMN_1677092,ILMN_1688670,ILMN_2413898,ILMN_1789095,ILMN_2297626,ILMN_3239576,ILMN_1675946,ILMN_2136089,ILMN_1705266,ILMN_1672503,ILMN_1815023,ILMN_1798354,ILMN_2287888,ILMN_1684497,ILMN_1795715,ILMN_2336982,ILMN_1798459,ILMN_2329914,ILMN_2176592,ILMN_1733560,ILMN_1781207,ILMN_1658383,ILMN_1784031,ILMN_1804384,ILMN_1665736,ILMN_1768534,ILMN_2367883,ILMN_1763828,ILMN_1798256,ILMN_2151488,ILMN_1803745,ILMN_1837428,ILMN_1710479,ILMN_1683891,ILMN_1880406,ILMN_1685954,ILMN_1805410,ILMN_2225718,ILMN_1805024,ILMN_1775330,ILMN_3230435,ILMN_1722276,ILMN_1762899,ILMN_2234229,ILMN_1665510,ILMN_1767068,ILMN_1800131,ILMN_1775498,ILMN_2231051,ILMN_1855746,ILMN_1796508,ILMN_2162799,ILMN_1693124,ILMN_1771841,ILMN_1652790,ILMN_1671554,ILMN_1808779,ILMN_2381753,ILMN_2212878,ILMN_1660439,ILMN_1656129,ILMN_1707434,ILMN_3237956,ILMN_2341611,ILMN_1710207,ILMN_1656521,ILMN_1686535,ILMN_1802519,ILMN_1690259,ILMN_1708167,ILMN_1666609,ILMN_1745497,ILMN_1775170,ILMN_1746664,ILMN_2098446,ILMN_1776105,ILMN_1775944,ILMN_3239181,ILMN_1660436,ILMN_1801175,ILMN_1741881,ILMN_2231242,ILMN_1701229,ILMN_2337336,ILMN_1665235,ILMN_2070896,ILMN_2324672,ILMN_1715401,ILMN_1758978,ILMN_2052891,ILMN_1732074,ILMN_1738589,ILMN_2068104,ILMN_2376263,ILMN_1691237,ILMN_2239772,ILMN_1662954,ILMN_1719695,ILMN_1716336,ILMN_1701753,ILMN_1675844,ILMN_1689525,ILMN_1761425,ILMN_3283742,ILMN_1737586,ILMN_2358069,ILMN_3304898,ILMN_1729115,ILMN_1808011,ILMN_1661366,ILMN_1773337,ILMN_1690708';
 # my $idType = 'ILLUMINA_ID';

 # my $inputIds = 'XM_376454,NM_001086,NM_020792,NM_020792,NM_207365,XM_938346,NM_001013630,NM_016228,NM_182662,NM_182662,NM_182662,NM_024666,NM_014911,NM_014911,M_014911';
 # my $idType = 'REFSEQ_MRNA';


# #read gene lsit ids from file
#  my $delimiter = ",";
#  open(geneList, "<$inputIdsFILE");
#    while(<geneList>)
#    {
#       my($line) = $_;   
#       chomp($line);
#       my $new_string = $line . $delimiter;
#       $inputIds .= $new_string;
#   };
#   print "$inputIds\n";
# close(geneList);

 my $inputIds = 'ILMN_1725814,ILMN_1658483,ILMN_1699651,ILMN_1775501,ILMN_2407799,ILMN_1716407,ILMN_1693014,ILMN_1661599,ILMN_1796417,ILMN_1803563,ILMN_1789793,ILMN_2401878,ILMN_1685703,ILMN_1711838,ILMN_1774685,ILMN_1680618,ILMN_1661861,ILMN_1682636,ILMN_2368530,ILMN_1698218,ILMN_2059357,ILMN_1683263,ILMN_1766551,ILMN_1795963,ILMN_1787815,ILMN_1666733,ILMN_3243616,ILMN_1718968,ILMN_2318638,ILMN_2188862,ILMN_2365465,ILMN_2407879,ILMN_2396444,ILMN_1681777,ILMN_1801122,ILMN_1681221,ILMN_1787897,ILMN_1801216,ILMN_1806845,ILMN_1677511,ILMN_2374164,ILMN_2137789,ILMN_2404112,ILMN_1722718,ILMN_1773154,ILMN_1670807,ILMN_1773567,ILMN_1660364,ILMN_2318643,ILMN_1714296,ILMN_1685580,ILMN_2054297,ILMN_1662618,ILMN_3202024,ILMN_1781285,ILMN_2401873,ILMN_1711573,ILMN_1745021,ILMN_1655904,ILMN_1702933,ILMN_1710544,ILMN_1773696,ILMN_1652280,ILMN_1696434,ILMN_1676984,ILMN_1727458,ILMN_1739241,ILMN_1759175,ILMN_2184373,ILMN_1808226,ILMN_1844408,ILMN_1653292,ILMN_1715991,ILMN_2094952,ILMN_1702691,ILMN_1718766,ILMN_1703650,ILMN_1740429,ILMN_3250483,ILMN_1720829,ILMN_1772612,ILMN_1740900,ILMN_2361862,ILMN_1731518,ILMN_1777060,ILMN_2374865,ILMN_1666742,ILMN_3240222,ILMN_1738725,ILMN_2366445,ILMN_2398107,ILMN_1657234,ILMN_2119123,ILMN_1799062,ILMN_1788384,ILMN_1655405,ILMN_3308265,ILMN_1751598,ILMN_2319588,ILMN_1721651,ILMN_2358457,ILMN_3223813,ILMN_2124802,ILMN_1729095,ILMN_2352090,ILMN_1784602,ILMN_2305116,ILMN_3196687,ILMN_2406586,ILMN_1775743,ILMN_1797596,ILMN_2134130,ILMN_1726456,ILMN_2355776,ILMN_1686697,ILMN_1724915,ILMN_1906187,ILMN_1797776,ILMN_1690807,ILMN_3235683,ILMN_2390859,ILMN_1763842,ILMN_1762407,ILMN_2219683,ILMN_2291891,ILMN_1694075,ILMN_1764361,ILMN_1688103,ILMN_1804822,ILMN_1838885,ILMN_1833858,ILMN_1730639,ILMN_1843198,ILMN_1672295,ILMN_2110908,ILMN_2179083,ILMN_1753111,ILMN_3236858,ILMN_1669523,ILMN_1653871,ILMN_1774077,ILMN_1659936,ILMN_1674811,ILMN_1720373,ILMN_2150851,ILMN_2096784,ILMN_2284744,ILMN_2399304,ILMN_1675507,ILMN_1806023,ILMN_1794038,ILMN_2054607,ILMN_1678968,ILMN_1752810,ILMN_1791280,ILMN_1682717,ILMN_1803811,ILMN_2374159,ILMN_2239754,ILMN_1737406,ILMN_1666503,ILMN_1712112,ILMN_1677402,ILMN_1814305,ILMN_1755741,ILMN_1714349,ILMN_1738552,ILMN_1760922,ILMN_2412281,ILMN_1705814,ILMN_1679929,ILMN_1784294,ILMN_3307841,ILMN_1775542,ILMN_2266948,ILMN_1710514,ILMN_1753342,ILMN_1730504,ILMN_1700413,ILMN_2392189,ILMN_1673586,ILMN_1698621,ILMN_1703955,ILMN_1669928,ILMN_1685714,ILMN_1723021,ILMN_1742534,ILMN_1745964,ILMN_1757872,ILMN_1904578,ILMN_2383419,ILMN_2327947,ILMN_1815079,ILMN_1695000,ILMN_1707748,ILMN_2199389,ILMN_2380605,ILMN_1735014,ILMN_2412384,ILMN_1811258,ILMN_2086077,ILMN_1799208,ILMN_1801610,ILMN_1781173,ILMN_3250104,ILMN_1737157,ILMN_1808325,ILMN_2150856,ILMN_1675992,ILMN_3241099,ILMN_1679826,ILMN_1777233,ILMN_1657248,ILMN_1732926,ILMN_2237428,ILMN_1792305,ILMN_1908989,ILMN_1766054,ILMN_2400322,ILMN_1689059,ILMN_2053281,ILMN_2246134,ILMN_2342066,ILMN_1756806,ILMN_2317658,ILMN_3250446,ILMN_1701869,ILMN_1694810,ILMN_1797822,ILMN_1727134,ILMN_1762608,ILMN_1695961,ILMN_1795835,ILMN_1772459,ILMN_3240605,ILMN_1654542,ILMN_1708016,ILMN_1736008,ILMN_2305112,ILMN_1739570,ILMN_1827736,ILMN_1691846,ILMN_1741171,ILMN_2361478,ILMN_2052208,ILMN_1844692,ILMN_1671442,ILMN_3251445,ILMN_1683146,ILMN_3243324,ILMN_1806165,ILMN_2404917,ILMN_3299447,ILMN_1762080,ILMN_1805534,ILMN_1709882,ILMN_1769615,ILMN_1717639,ILMN_1717056,ILMN_1769449,ILMN_1720053,ILMN_1755290,ILMN_2336094,ILMN_1785191,ILMN_1692864,ILMN_1770035,ILMN_1687315,ILMN_1809417,ILMN_1727001,ILMN_1737314,ILMN_1708516,ILMN_1652487,ILMN_1692177,ILMN_1774272,ILMN_1730670,ILMN_1685109,ILMN_1764396,ILMN_1664006,ILMN_1684316,ILMN_1788002,ILMN_1681644,ILMN_2091375,ILMN_2094360,ILMN_1727813,ILMN_3275771,ILMN_1687583,ILMN_1773413,ILMN_2345319,ILMN_2371590,ILMN_1714805,ILMN_3305735,ILMN_1691112,ILMN_2184612,ILMN_2190598,ILMN_1705579,ILMN_3204346,ILMN_3226012,ILMN_1806667,ILMN_1687743,ILMN_2415786,ILMN_1728785,ILMN_2395240,ILMN_2067852,ILMN_1786050,ILMN_1663080,ILMN_2271627,ILMN_1801984,ILMN_2192281,ILMN_1804938,ILMN_1699574,ILMN_3249501,ILMN_1769779,ILMN_1843932,ILMN_1734410,ILMN_3235647,ILMN_1803464,ILMN_2405684,ILMN_2075714,ILMN_2324421,ILMN_1726199,ILMN_3232219,ILMN_2149226,ILMN_1771800,ILMN_2370692,ILMN_1698323,ILMN_3243961,ILMN_1776788,ILMN_1810864,ILMN_1808789,ILMN_2392286,ILMN_2294684,ILMN_1666494,ILMN_2406501,ILMN_1715771,ILMN_1731699,ILMN_2209163,ILMN_1674782,ILMN_3235964,ILMN_1720988,ILMN_1716790,ILMN_1763104,ILMN_1805192,ILMN_1651496,ILMN_2367239,ILMN_1707137,ILMN_1671404,ILMN_1741628,ILMN_1694589,ILMN_1749521,ILMN_1761314,ILMN_1689004,ILMN_1735959,ILMN_1746375,ILMN_1663640,ILMN_1804737,ILMN_1680738,ILMN_3245062,ILMN_1767662,ILMN_1694475,ILMN_2310296,ILMN_1708858,ILMN_2275248,ILMN_1778168,ILMN_2215881,ILMN_1735877,ILMN_2075820,ILMN_1769135,ILMN_1789364,ILMN_2391231,ILMN_3239885,ILMN_1679041,ILMN_1680139,ILMN_2214678,ILMN_1777895,ILMN_1753567,ILMN_3236428,ILMN_1741224,ILMN_1775573,ILMN_1724753,ILMN_2322375,ILMN_1784328,ILMN_1702211,ILMN_1815141,ILMN_2074044,ILMN_1752631,ILMN_1666615,ILMN_2377210,ILMN_3245310,ILMN_1745112,ILMN_2357134,ILMN_1758232,ILMN_1793651,ILMN_2220184,ILMN_3280735,ILMN_1736340,ILMN_1727553,ILMN_3221790,ILMN_2349459,ILMN_1715508,ILMN_1758164,ILMN_2096083,ILMN_1674633,ILMN_1736939,ILMN_1696946,ILMN_1660793,ILMN_1764329,ILMN_1760649,ILMN_1758339,ILMN_1668634,ILMN_2188374,ILMN_1679867,ILMN_1776181,ILMN_1851547,ILMN_2386354,ILMN_1769082,ILMN_1698139,ILMN_1680378,ILMN_3305273,ILMN_2202423,ILMN_3298716,ILMN_3249645,ILMN_1701441,ILMN_1683538,ILMN_1680154,ILMN_1747183,ILMN_2371825,ILMN_1759232,ILMN_2094776,ILMN_3226082,ILMN_2293374,ILMN_1779847,ILMN_2149766,ILMN_1734559,ILMN_1703412,ILMN_2395389,ILMN_2406873,ILMN_2143250,ILMN_1757867,ILMN_1671005,ILMN_1653824,ILMN_2366334,ILMN_3207233,ILMN_1681283,ILMN_3238854,ILMN_1814526,ILMN_1731113,ILMN_1773959,ILMN_2336609,ILMN_1677092,ILMN_1688670,ILMN_2413898,ILMN_1789095,ILMN_2297626,ILMN_3239576,ILMN_1675946,ILMN_2136089,ILMN_1705266,ILMN_1672503,ILMN_1815023,ILMN_1798354,ILMN_2287888,ILMN_1684497,ILMN_1795715,ILMN_2336982,ILMN_1798459,ILMN_2329914,ILMN_2176592,ILMN_1733560,ILMN_1781207,ILMN_1658383,ILMN_1784031,ILMN_1804384,ILMN_1665736,ILMN_1768534,ILMN_2367883,ILMN_1763828,ILMN_1798256,ILMN_2151488,ILMN_1803745,ILMN_1837428,ILMN_1710479,ILMN_1683891,ILMN_1880406,ILMN_1685954,ILMN_1805410,ILMN_2225718,ILMN_1805024,ILMN_1775330,ILMN_3230435,ILMN_1722276,ILMN_1762899,ILMN_2234229,ILMN_1665510,ILMN_1767068,ILMN_1800131,ILMN_1775498,ILMN_2231051,ILMN_1855746,ILMN_1796508,ILMN_2162799,ILMN_1693124,ILMN_1771841,ILMN_1652790,ILMN_1671554,ILMN_1808779,ILMN_2381753,ILMN_2212878,ILMN_1660439,ILMN_1656129,ILMN_1707434,ILMN_3237956,ILMN_2341611,ILMN_1710207,ILMN_1656521,ILMN_1686535,ILMN_1802519,ILMN_1690259,ILMN_1708167,ILMN_1666609,ILMN_1745497,ILMN_1775170,ILMN_1746664,ILMN_2098446,ILMN_1776105,ILMN_1775944,ILMN_3239181,ILMN_1660436,ILMN_1801175,ILMN_1741881,ILMN_2231242,ILMN_1701229,ILMN_2337336,ILMN_1665235,ILMN_2070896,ILMN_2324672,ILMN_1715401,ILMN_1758978,ILMN_2052891,ILMN_1732074,ILMN_1738589,ILMN_2068104,ILMN_2376263,ILMN_1691237,ILMN_2239772,ILMN_1662954,ILMN_1719695,ILMN_1716336,ILMN_1701753,ILMN_1675844,ILMN_1689525,ILMN_1761425,ILMN_3283742,ILMN_1737586,ILMN_2358069,ILMN_3304898,ILMN_1729115,ILMN_1808011,ILMN_1661366,ILMN_1773337,ILMN_1690708';
 my $idType = 'ILLUMINA_ID';

 print  "\nCurrent ID Types: \n$idType\n"; 

 my $listName = 'make_up';
 my $listType=0;
 #to add background list, set listType=1
 my $list = $soap ->addList($inputIds, $idType, $listName, $listType)->result;
 print "\n$list of list was mapped\n"; 
  	
 #list all species  names
 my $allSpecies= $soap ->getSpecies()->result;	 	  	
 # print  "\nAll species: \n$allSpecies\n"; 
 #list current species  names
 my $currentSpecies= $soap ->getCurrentSpecies()->result;	 	  	
 print  "\nCurrent species: \n$currentSpecies\n"; 

 #set user defined species 
 #my $species = $soap ->setCurrentSpecies("1")->result;
 print "\nCurrent species: \n$species\n"; 
 
#set user defined categories 
#my $categories = $soap ->setCategories("BBID,BIOCARTA,COG_ONTOLOGY,INTERPRO,KEGG_PATHWAY,OMIM_DISEASE,PIR_SUPERFAMILY,SMART,UP_SEQ_FEATURE")->result;
#to user DAVID default categories, send empty string to setCategories():
my $categories = $soap ->setCategories("")->result;
# my $categories = $soap ->setCategories("KEGG_PATHWAY")->result; 
my $categories = $soap ->setCategories("REACTOME_PATHWAY,PANTHER_PATHWAY,BBID,GOTERM_CC_FAT,BIOCARTA,SP_PIR_KEYWORDS,GOTERM_MF_FAT,UP_SEQ_FEATURE,COG_ONTOLOGY,INTERPRO,KEGG_PATHWAY,OMIM_DISEASE,GOTERM_BP_FAT,PIR_SUPERFAMILY")->result;

print "\nValid categories: \n$categories\n\n";  

open (chartReport, ">", "$chartReportFILE");
print chartReport "Category\tTerm\tCount\t%\tPvalue\tGenes\tList Total\tPop Hits\tPop Total\tFold Enrichment\tBonferroni\tBenjamini\tFDR\n";
#close chartReport;

#open (chartReport, ">>", "chartReport.txt");
#getChartReport 	
my $thd=0.1; # EASE Score, a modified Fisher Exact P-Value https://david-d.ncifcrf.gov/helps/functional_annotation.html#fisher
my $ct = 2;  # The threshold of minimum gene counts belonging to an annotation term. It has to be equal or greater than 0. Default is 2. In short, you do not trust the term only having one gene involved
my $chartReport = $soap->getChartReport($thd,$ct);
	my @chartRecords = $chartReport->paramsout;
	#shift(@chartRecords,($chartReport->result));
	#print $chartReport->result."\n";
  	print "Total chart records: ".(@chartRecords+1)."\n";
  	print "\n ";
	#my $retval = %{$chartReport->result};
	my @chartRecordKeys = keys %{$chartReport->result};
	
	#print "@chartRecordKeys\n";
	
	my @chartRecordValues = values %{$chartReport->result};
	
	my %chartRecord = %{$chartReport->result};
	my $categoryName = $chartRecord{"categoryName"};
	my $termName = $chartRecord{"termName"};
	my $listHits = $chartRecord{"listHits"};
	my $percent = $chartRecord{"percent"};
	my $ease = $chartRecord{"ease"};
	my $Genes = $chartRecord{"geneIds"};
	my $listTotals = $chartRecord{"listTotals"};
	my $popHits = $chartRecord{"popHits"};
	my $popTotals = $chartRecord{"popTotals"};
	my $foldEnrichment = $chartRecord{"foldEnrichment"};
	my $bonferroni = $chartRecord{"bonferroni"};
	my $benjamini = $chartRecord{"benjamini"};
	my $FDR = $chartRecord{"afdr"};
	
	print chartReport "$categoryName\t$termName\t$listHits\t$percent\t$ease\t$Genes\t$listTotals\t$popHits\t$popTotals\t$foldEnrichment\t$bonferroni\t$benjamini\t$FDR\n";
	
	
	for $j (0 .. (@chartRecords-1))
	{			
		%chartRecord = %{$chartRecords[$j]};
		$categoryName = $chartRecord{"categoryName"};
		$termName = $chartRecord{"termName"};
		$listHits = $chartRecord{"listHits"};
		$percent = $chartRecord{"percent"};
		$ease = $chartRecord{"ease"};
		$Genes = $chartRecord{"geneIds"};
		$listTotals = $chartRecord{"listTotals"};
		$popHits = $chartRecord{"popHits"};
		$popTotals = $chartRecord{"popTotals"};
		$foldEnrichment = $chartRecord{"foldEnrichment"};
		$bonferroni = $chartRecord{"bonferroni"};
		$benjamini = $chartRecord{"benjamini"};
		$FDR = $chartRecord{"afdr"};			
		print chartReport "$categoryName\t$termName\t$listHits\t$percent\t$ease\t$Genes\t$listTotals\t$popHits\t$popTotals\t$foldEnrichment\t$bonferroni\t$benjamini\t$FDR\n";				 
	}		  	
	
	close chartReport;
	print "\n$chartReportFILE generated\n";
} 
__END__
		